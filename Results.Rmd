---
title: "프로젝트 데이터 수집 결과와 기본 분석"
author: "김예슬 김정인"
date: '2020 6 24 '
output:
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(bizstatp)
library(tidyverse)

final2018 <- read.csv("final2018.csv", fileEncoding = "UTF-8")
final2019 <- read.csv("final2019.csv", fileEncoding = "UTF-8")
```

# 프로젝트 개요

## 프로젝트 명
야구 응원관람객수가 많으면 야구팀의 승률이 높아질까?

## 프로젝트 수행 동기 및 이유
 야구 관람의 가장 큰 묘미는 응원이다. 10개의 프로구단이 있고 구단마다 특색이 담긴 다양한 응원방법이 존재한다. 경기를 관람하는 사람을 신나게 할 정도로 야구 응원문화가 있지만, 한편으로는 야구장 주변 주민들의 소음피해로 손해배상 청구 소송이 일어나기도 한다. [1]
 이처럼 장점도 있지만, 큰소리로 문제가 되기도 하는 응원이 선수들에게 경기를 이끌어 가는데 도움을 주는지 의문이 들었다. 실제로 야구장을 가보면 관객들은 큰 소리로 응원하는 반면에 선수들은 집중하기 위해서 관람석을 보지 않고 경기에 몰입해있다. 본팀은 야구장에 응원하러 가는 팬으로써 이 의문을 해소하기 위해서 이번 프로젝트의 주제로 선정하게 되었다. 

## 프로젝트 목표
1.10개 팀별로 2018년 ~ 2020년 승률 및 관객수 데이터를 수집한다.

2.홈팀을 기준으로 데이터를 추린다.

3.홈팀의 관중수와 승률의 상관관계를 알아보는 분석을 하고 결과를 도출한다.

# 데이터 수집

## 데이터 수집 계획
 2018년과 2018년은 총 관객수의 크기가 같고 가장 최신의 데이터로 수집대상으로 선정하게 되었다.
 데이터는 2018-2020년 KBO정규시즌의 일자별 관중현황과 승패데이터를 수집해야한다. 먼저 일자별 관중현황은 KBO홈페이지에서 수집하였다[2]. 또한, 승패데이터는 GITHUB에서 2018-2019년 데이터를 수집하였다[3]. 
 
 

## 데이터 수집 결과 

### 1.데이터 수집 크기
```{r}
format(object.size(final2018), units = "auto")
```

```{r}
format(object.size(final2019), units = "auto")
```

### 2.데이터 각 열에 대한 설명

1) x : 경기횟수

2) data : 날짜

3) home : 홈팀

4) homewin: 홈팀우승여부

5) visit : 원정팀

6) place : 경기장위치

7) number_audience : 관중수


# 기본 분석

## 개요


```{r}

test2018 <- read.csv("final2018.csv", fileEncoding = "UTF-8")
test2019 <- read.csv("final2019.csv", fileEncoding = "UTF-8")

summary(test2018)
summary(test2019)

```
   
   경기(x)는 년도별로 710여번 치뤄졌고, 홈(home)과 방문(visit)인 경기가 각 팀별로 일정하게 치뤄지고 있는 것을 볼 수 있다. 
   
   홈팀 승리(homewin)변수를 보면 홈팀이 이기는 횟수가 패배보다 많은 것을 볼 수 있다. 
   
   또한, 관객수(number_audience)는 최소, 최대, 평균값을 보면 2018-2019년이 비슷한 추세를 기록하고 있는 것을 볼 수 있다. 

## 변수별 분석

### 1.2018-2019년의 구단별 홈경기장의 승패 횟수를 표로 표현하였다. 
   
```{r}

table2 <- xtabs(~home + homewin, data=test2018)
table2

table1 <- xtabs(~home.x + homewin, data=test2019)
table1

```

   2018년에는 삼성, 롯데, NC, KT와 2019년에는 롯데, 삼성, 한화를 제외하고는 다른 구단들은 홈경기장에서 경기를 치루면 높은 승리를 거둔 것을 볼 수 있다. 
   
   
### 2. 2018-2019년 구단별 홈경기장 관객 수이다. 

 아래의 표는 2018,2019년 각각의 구단별 관객수의 평균, 최소, 최대, 총합을 보여주는 표이다.
```{r}
#2018
a18 <- test2018 %>% group_by(home) %>% 
   summarize(mean_au=mean(number_audience),max_au=max(number_audience),min_au=min(number_audience), total_au=sum(number_audience))
a18 <- arrange(a18, desc(total_au))
a18

#2019
a19 <- test2019 %>% group_by(home.x) %>% 
   summarize(mean_au=mean(number_audience), max_au=max(number_audience), min_au=min(number_audience),total_au=sum(number_audience))
a19 <- arrange(a19, desc(total_au))
a19

```

 아래의 그래프는 2018,2019년의 위의 표를 그래프로 보여준다.
 
 막대그래프는 평균, 빨간 선그래프는 최소관객수, 파란선그래프는 최대관객수를 표현한다.
 
```{r}

#2018
ggplot() + geom_col(aes(x=home, y=mean_au, color=home), data=a18) +
  geom_line(aes(x=home, min_au),col="red", group=1,  data=a18) + 
  geom_line(aes(x=home, max_au), col="blue", group=1, data=a18) 

#2019
ggplot() + geom_col(aes(x=home.x, y=mean_au, color=home.x), data=a19) +
  geom_line(aes(x=home.x, min_au),col="red", group=1, data=a19) + 
  geom_line(aes(x=home.x, max_au), col="blue", group=1, data=a19) 


```
   
   표와 그래프를 보면 2018-2019년 각기 차이가 있지만 두산, LG, SK가 일정하게 높은 관객수를 기록하고 있는 것을 보여주고 있다.

## 상관성 분석

### 1.homewin열을 원핫인코딩   
```{r}
#2018
#원핫인코딩
new2018<-transform(test2018,
                   win = ifelse(homewin =="win", 1, 0),
                   lose = ifelse(homewin =="lose", 1, 0),
                   same = ifelse(homewin =="same", 1, 0))
head(new2018)

```
```{r}
#2019
#원핫인코딩
new2019<-transform(test2019,
                   win = ifelse(homewin =="win", 1, 0),
                   lose = ifelse(homewin =="lose", 1, 0),
                   same = ifelse(homewin =="same", 1, 0))
head(new2019)
```
 
 상관계수를 구하기 위해 범주형 변수를 원핫인코딩한다.
 
### 2.cor()을 통한 상관계수 구하기
 2018년-2019년의 관객수와 win(승)열과의 각각의 상관계수를 구한 결과, 
 
 두 해 모두 관객수와 win(승)은 0에 가까운 수를 보여 두 변수의 선형 상관성이 없다.
```{r}
#2018
cor(new2018$number_audience, new2018$win, use = "complete.obs")
#2019
cor(new2019$number_audience, new2019$win, use = "complete.obs")
```

   
# 가설검정
## 가설1. 2018-2019의 년도별 승패에 따른 평균 관객수의 차이가 없을 것이다.

 2018년-2019년의 승패에 따른 평균 관객수에 대한 가설검정

 귀무가설(H_0) : 승패에 따른 평균의 차가 0일 것이다.
 
 대립가설(H_1) : 승패에 따른 평균의 차가 0이 아닐 것이다.
 
 
  - 승패 데이터 추출 
```{r}
#2018년
new2018_2 <- filter(new2018, homewin=="lose" | homewin=="win")
#2019년
new2019_2 <- filter(new2019, homewin=="lose" | homewin=="win")
```


 - 2018-2019년 별 관객수 통계량
 
 -2018년
```{r}
#2018년 
new2018_2 %>%group_by(homewin) %>%
  summarise(mean=mean(number_audience),median=median(number_audience),
            sd=sd(number_audience),mad=mad(number_audience),
            skew=psych::skew(number_audience),kurtosis=psych::kurtosi(number_audience))

ggplot(new2018_2) + geom_boxplot(aes(homewin, number_audience), norch=T)

```
 
 -2019년
```{r}
#2019년
new2019_2 %>%group_by(homewin) %>%
  summarise(mean=mean(number_audience),median=median(number_audience),
            sd=sd(number_audience),mad=mad(number_audience),
            skew=psych::skew(number_audience),kurtosis=psych::kurtosi(number_audience))

ggplot(new2019_2) + geom_boxplot(aes(homewin, number_audience), norch=T)

```
 
 
  - 가설검정 
 
 -2018년
```{r}
#2018년
t.test(number_audience ~ homewin, data=new2018_2)
```
 -2019년
```{r}
#2019년
t.test(number_audience ~ homewin, data=new2019_2)

```
 2018-2019년 모두 신뢰구간 95%로 p-value가 0.05를 넘으므로 귀무가설을 채택한다. 
 
 따라서, 승패별 평균 관객수 차이는 없다.

## 추가적인 가설 검정

 전체데이터가 아닌 범위를 좁혀서 가설검정을 해보기로 하였다.
 
 2018-2019년 1등팀과 10등팀 각각의 승패에 따른 평균 관객수의 가설 검정이다.

 1. 2018-2019년 1등팀 가설 검정 
  
 가설. 2018-2019의 1등 팀의 년도별 승패에 따른 평균 관객수의 차이가 없을 것이다.

 2018년-2019년의 1등 팀의 승패에 따른 평균 관객수에 대한 가설검정

 귀무가설(H_0) : 승패에 따른 평균의 차가 0일 것이다.
 
 대립가설(H_1) : 승패에 따른 평균의 차가 0이 아닐 것이다.
 
 - 데이터 추출 : 2018년 SK와 2019년 두산  
```{r}
#home이 "SK"인 행만 추출
winner_2018 <- new2018[new2018$home=="SK",]
#home이"두산"인 행만 추출
winner_2019 <- new2019[new2019$home.x=="두산",]
```

 - 팀별 관객수 통계량

 -2018년 SK
```{r}
# 2018년 SK
winner_2018 %>%group_by(win) %>%
  summarise(mean=mean(number_audience),median=median(number_audience),
            sd=sd(number_audience),mad=mad(number_audience),
            skew=psych::skew(number_audience),kurtosis=psych::kurtosi(number_audience))

#boxplot
ggplot(winner_2018) + geom_boxplot(aes(homewin, number_audience), norch=T)
```

-2019년 두산
```{r}
# 2019년 두산
winner_2019 %>%group_by(win) %>%
  summarise(mean=mean(number_audience),median=median(number_audience),
            sd=sd(number_audience),mad=mad(number_audience),
            skew=psych::skew(number_audience),kurtosis=psych::kurtosi(number_audience))
ggplot(winner_2019) + geom_boxplot(aes(homewin, number_audience), norch=T)

```


 - 가설검정 
 
 -2018년 SK
```{r}
t.test(number_audience~win, data=filter(winner_2018))
```
 -2019년 두산
```{r}
t.test(number_audience~win, data=filter(winner_2019)) 
```

2018-2019년 모두 신뢰구간 95%로 p-value가 0.05를 넘으므로 귀무가설을 채택한다. 
 
 따라서, 1등 팀별 승패별 평균 관객수 차이는 없다.
 
 
 
 
 
 2. 2018-2019년 10등팀 가설 검정 
  
 가설. 2018-2019의 10등 팀의 년도별 승패에 따른 평균 관객수의 차이가 없을 것이다.

 2018년-2019년의 10등 팀의 승패에 따른 평균 관객수에 대한 가설검정

 귀무가설(H_0) : 승패에 따른 평균의 차가 0일 것이다.
 
 대립가설(H_1) : 승패에 따른 평균의 차가 0이 아닐 것이다.
 
 - 데이터 추출 : 2018년 NC와 2019년 롯데  
```{r}
#2018년
loser_2018 <- new2018[new2018$home=="NC",]
#2019년
loser_2019 <- new2019[new2019$home.x=="롯데",]
```

 - 팀별 관객수 통계량

 -2018년 NC
```{r}
# 2018년 NC
loser_2018 %>%group_by(lose) %>%
  summarise(mean=mean(number_audience),median=median(number_audience),
            sd=sd(number_audience),mad=mad(number_audience),
            skew=psych::skew(number_audience),kurtosis=psych::kurtosi(number_audience))

#boxplot
ggplot(loser_2018) + geom_boxplot(aes(homewin, number_audience), norch=T)
```

-2019년 롯데
```{r}
# 2019년 롯데
loser_2019 %>%group_by(lose) %>%
  summarise(mean=mean(number_audience),median=median(number_audience),
            sd=sd(number_audience),mad=mad(number_audience),
            skew=psych::skew(number_audience),kurtosis=psych::kurtosi(number_audience))
ggplot(loser_2019) + geom_boxplot(aes(homewin, number_audience), norch=T)

```


 - 가설검정 
 
 -2018년 NC
```{r}
t.test(number_audience~win, data=filter(loser_2018))
```
 
 -2019년 롯데
```{r}
t.test(number_audience~win, data=filter(loser_2019)) 
```

 2018-2019년 모두 신뢰구간 95%로 p-value가 0.05를 넘으므로 귀무가설을 채택한다. 
 
 따라서, 10등 팀별 승패별 평균 관객수 차이는 없다.


## 결론
 
 야구의 궁금증과 애정으로 "야구 응원관람객수가 많으면 야구팀의 승률이 높아질까?"의 가설에 대한 분석을 시작하게 되었다. 하지만 당초 세웠던 가설은 맞지 않았다.
 관객수와 승패 두 변수간의 선형 상관성이 없었고, 승패별 관객 평균값의 차이는 0을 보였다.
 또한 팀별로 차이가 있을 것이라 생각하여 두드러지게 차이를 보이는 1등과 10등팀과도 승패에 따른 관객수의 평균도 가설검정을 해보았지만 같은 결론이 나오게 되었다.
 이로써 야구의 승패는 관객수와 상관이 없다는 것을 알 수 있다.
```{r}
ggplot(new2018_2) + geom_boxplot(aes(homewin, number_audience,fill=home), norch=T)
ggplot(new2019_2) + geom_boxplot(aes(homewin, number_audience,fill=home.x), norch=T)

```


# 출처
[1] 위키백과, 대한민국의 야구 응원 문화
https://ko.wikipedia.org/wiki/%EB%8C%80%ED%95%9C%EB%AF%BC%EA%B5%AD%EC%9D%98_%EC%95%BC%EA%B5%AC_%EC%9D%91%EC%9B%90_%EB%AC%B8%ED%99%94#%EB%B9%84%ED%8C%90
[2] KBO, 일자별 관중수, https://www.koreabaseball.com/History/Crowd/GraphDaily.aspx
[3] github, KBO 승패 데이터, https://github.com/kimchangkyu/Prediction_of_Attendance_in_KBO/blob/master/datas/kbo_results.csv